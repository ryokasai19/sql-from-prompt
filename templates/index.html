<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL from Prompt</title>
  <style>
  body {
    font-family: sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 2rem;
    display: flex;
    justify-content: center;
  }

  .container {
    max-width: 800px;
    width: 100%;
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  h1, h2 {
    text-align: center;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  input[type="file"],
  input[type="text"],
  button {
    font-size: 1rem;
    padding: 0.5rem;
  }

  pre {
    background: #f3f3f3;
    padding: 1rem;
    white-space: pre-wrap;
    border-left: 3px solid #007acc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 0.75rem;
    text-align: left;
  }

  th {
    background-color: #eee;
  }
</style>

</head>
<body>
    <div class="container">
        <h1>Ask Your Data</h1>

        <form id="query-form">
            <label for="db">Upload SQLite DB:</label>
            <input type="file" id="db" name="db" required><br><br>

            <label for="prompt">Your Question:</label>
            <input type="text" id="prompt" name="prompt" required><br><br>

            <button type="submit">Submit</button>
        </form>

        <h2>Question</h2>
        <pre id="question-box">(waiting...)</pre>

        <h2>Generated SQL</h2>
        <pre id="sql-box">(waiting...)</pre>

        <h2>Results</h2>
        <div id="results">(waiting...)</div>

        <script>
            document.getElementById('query-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            const promptText = document.getElementById('prompt').value;
            formData.append('db', document.getElementById('db').files[0]);
            formData.append('prompt', promptText);

            const res = await fetch('/query', {
                method: 'POST',
                body: formData
            });

            const data = await res.json();

            document.getElementById('question-box').textContent = promptText;
            document.getElementById('sql-box').textContent = data.sql || '(no SQL)';
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (data.result && data.result.length) {
                const table = document.createElement('table');
                const header = document.createElement('tr');
                Object.keys(data.result[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                header.appendChild(th);
                });
                table.appendChild(header);

                data.result.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(row).forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    tr.appendChild(td);
                });
                table.appendChild(tr);
                });

                resultsDiv.appendChild(table);
            } else {
                resultsDiv.textContent = 'No results.';
            }

            // âœ… Clear prompt field after submit
            document.getElementById('prompt').value = '';
            });
        </script>
    </div>
</body>
</html>
